# NFL Live Game Simulator

A web-based application that shows "what happens next" probabilities during live NFL games. Track games in real-time, see conversion probabilities, and explore player stats.

## Features

- **Live Game Tracking**: View all live NFL games with real-time updates (30-60 second delay)
- **Probability Calculator**: See pass vs run success probabilities based on historical data
- **Team-Specific Analysis**: Compare team performance vs league averages
- **Player Stats**: Click on players to see their stats and impact on success probability
- **Smart Caching**: Aggressive caching to stay under ESPN API rate limits
- **Responsive Design**: Works on desktop, tablet, and mobile

## Quick Start

### 1. Installation

No build tools or dependencies required! Just open the HTML file in your browser.

```bash
cd nfl-live-simulator
```

### 2. Open the Application

Simply open `index.html` in any modern web browser:

```bash
# On Mac
open index.html

# On Linux
xdg-open index.html

# On Windows
start index.html
```

Or just double-click `index.html`.

### 3. (Optional) Generate Historical Probability Data

For more accurate probabilities based on real NFL data, run the Python preprocessing script:

```bash
# Install dependencies
pip install nfl_data_py pandas

# Run the script
cd preprocessing
python generate_probabilities.py
```

This will create `probability-data.json` with historical conversion rates. Without this file, the app will use simple fallback heuristics.

## How to Use

### Game Selection Screen

1. The app opens showing all live NFL games
2. Click on any game card to view detailed analysis
3. Click "Refresh" to update the game list

### Game View Screen

1. **Game State**: See current score, quarter, time, down/distance, and field position
2. **Probabilities**: View success probabilities for pass vs run plays
   - League average (all teams)
   - Team-specific (current season data)
3. **Team Focus**: Choose which team to track:
   - **Home Team**: Show home team's offensive players
   - **Away Team**: Show away team's offensive players
   - **Neutral**: Show team currently on offense
4. **Players**: Click on any player to see:
   - Season stats
   - Current game stats
   - Impact on success probability
5. **Recent Plays**: Scroll through the last 20 plays
6. **Auto-Refresh**: Game updates automatically every 30 seconds

## Architecture

### File Structure

```
nfl-live-simulator/
‚îú‚îÄ‚îÄ index.html                    # Main HTML structure
‚îú‚îÄ‚îÄ styles.css                    # All styling
‚îú‚îÄ‚îÄ app.js                        # Main application logic
‚îú‚îÄ‚îÄ api.js                        # ESPN API integration (swap this to change API)
‚îú‚îÄ‚îÄ probabilities.js              # Probability calculations
‚îú‚îÄ‚îÄ storage.js                    # localStorage management
‚îú‚îÄ‚îÄ utils.js                      # Helper functions
‚îú‚îÄ‚îÄ probability-data.json         # Historical data (generated by Python)
‚îú‚îÄ‚îÄ README.md                     # This file
‚îî‚îÄ‚îÄ preprocessing/
    ‚îî‚îÄ‚îÄ generate_probabilities.py # Python script to generate data
```

### Data Flow

```
ESPN API ‚Üí api.js ‚Üí localStorage cache ‚Üí app.js ‚Üí UI
                                           ‚Üì
probability-data.json ‚Üí probabilities.js ‚Üí UI
```

### API Abstraction

All ESPN API calls are in `api.js`. To upgrade to a paid API:

1. Modify `api.js` functions:
   - `fetchLiveGames()`
   - `fetchGameSummary()`
   - `fetchPlayByPlay()`
2. Update API URLs and add authentication
3. Adjust polling interval (can go faster with paid API)
4. Everything else stays the same!

## Rate Limiting

### ESPN API Limits

- **~200 requests/day** before potential throttling
- App uses **smart polling**:
  - Only refreshes when game state changes
  - Caches scoreboard for 5 minutes
  - Caches game data for 30 seconds
  - Slows down if no changes detected

### Estimated Usage

For a typical 3-hour game:
- Scoreboard: ~37 requests (every 5 min)
- Game updates: ~51 requests (only on state changes)
- **Total: ~88 requests per game** ‚úì Under budget!

### If Rate Limited

- App will show banner notification
- Will use cached data
- Auto-refresh disabled, manual refresh only
- Rate limit resets after 5 minutes

## Browser Compatibility

Works on all modern browsers:
- Chrome/Edge (recommended)
- Firefox
- Safari
- Mobile browsers

## Development

### Local Development

For live reloading during development:

1. Install a simple HTTP server:
   ```bash
   # Python 3
   python -m http.server 8000

   # Node.js
   npx http-server
   ```

2. Open http://localhost:8000

### Debugging

Open browser DevTools console to see:
- API request logs
- Cache hit/miss status
- Storage usage
- Error messages

Use these debug commands in console:
```javascript
// View current state
appState

// View storage usage
logStorageInfo()

// Clear all cache
clearAllCache()

// Reset rate limit flag
resetRateLimit()
```

## Upgrading to Paid API

### Why Upgrade?

- **Faster updates**: <5 second latency vs 30-60 seconds
- **No rate limits**: Unlimited requests
- **More reliable**: Guaranteed uptime
- **WebSocket support**: True real-time streaming

### Recommended Paid APIs

1. **TheRundown** - $49.99/month
   - Real-time scores and stats
   - WebSocket streaming available
   - https://therundown.io/

2. **SportsDataIO** - Contact for pricing
   - Comprehensive NFL data
   - Very reliable
   - https://sportsdata.io/

3. **Sportradar** - Enterprise pricing
   - Official NFL data provider
   - Highest quality
   - https://developer.sportradar.com/

### How to Upgrade

1. Get API key from chosen provider
2. Modify `api.js`:
   ```javascript
   // Change API URLs
   const ESPN_API = {
       SCOREBOARD: 'https://your-api.com/scoreboard',
       // ... etc
   };

   // Add authentication
   const response = await fetch(url, {
       headers: {
           'Authorization': 'Bearer YOUR_API_KEY'
       }
   });

   // Reduce polling interval
   appState.refreshInterval = setInterval(async () => {
       await autoRefresh(gameId);
   }, 5 * 1000); // 5 seconds instead of 30
   ```

3. Everything else stays the same!

## Troubleshooting

### "No live games" message

- Games only happen Thu/Sun/Mon during NFL season
- Check that it's actually game day
- Try manual refresh

### "Failed to load games" error

- Check internet connection
- ESPN API may be down (rare)
- Try clearing cache: `clearAllCache()` in console

### Probabilities seem wrong

- Run the preprocessing script for accurate data
- Without `probability-data.json`, app uses simple heuristics
- Some situations may have limited historical data

### Auto-refresh stopped working

- Game may have ended
- May be rate limited (check for banner)
- Try manual refresh

### App is slow

- Clear cache: `clearAllCache()` in console
- Close other browser tabs
- Check Network tab in DevTools for slow requests

## Data Sources

- **Live game data**: ESPN unofficial API
- **Historical data**: nflverse (nfl_data_py)
- **Probability calculations**: Based on 2024-2025 season data

## Disclaimer

This application is for entertainment and educational purposes only. Probability calculations are estimates based on historical data and should not be used for gambling or betting purposes.

## Future Enhancements

Possible features to add:
- Weather impact on probabilities
- Player injury status
- Historical matchup data
- Win probability graph
- Export game data
- Multi-game view
- Season-long tracking
- Custom probability models

## License

For personal use only. ESPN data usage subject to their terms of service.

## Support

For issues or questions:
1. Check browser console for errors
2. Try clearing cache and refreshing
3. Make sure you're using a modern browser
4. Verify ESPN API is accessible

## Credits

Built with:
- Vanilla JavaScript (no frameworks)
- ESPN API (unofficial)
- nflverse/nfl_data_py for historical data
- Love for football analytics!

---

Enjoy analyzing NFL games! üèà
